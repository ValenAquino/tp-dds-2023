{{#partial "principal" }}

<script src="/incidentesScript.js"></script>

<div>
    <h3 {{#stringIsEqual "pendientes" vista}}class="mb-4 mr-4 ml-2"{{else}}class="mr-4 ml-2"{{/stringIsEqual}} style="margin-left: 6%;">{{#stringIsEqual "pendientes" vista}}Incidentes pendientes{{else}}Incidentes{{/stringIsEqual}}</h3>
        {{#stringIsEqual "pendientes" vista}}
        {{else}}
            <h5 class="mb-4" style="margin-left: 6%;">{{comunidad_nombre}}</h5>
            <a style="margin-left: 6%;" href="incidentes" {{#stringIsEqual "todos" estado}} class="mr-1 selected-filter" {{else}} class="mr-1 filter" {{/stringIsEqual}}>Todos</a>
            <a {{#stringIsEqual "abierto" estado}} class="mr-1 selected-filter" {{else}} class="mr-1 filter" {{/stringIsEqual}} href="incidentes?estado=abierto">Abiertos</a>
            <a {{#stringIsEqual "cerrado" estado}} class="mr-1 selected-filter" {{else}} class="mr-1 filter" {{/stringIsEqual}} href="incidentes?estado=cerrado">Cerrados</a>
        {{/stringIsEqual}}
        {{#if after_action}}
            <p style="color: rgb(59, 214, 113);font-weight:500;margin-left: 6%;margin-top:1%;margin-bottom:0;">{{message}}</p>
        {{/if}}
    <div class="d-flex flex-row flex-wrap" style="margin-left: 4.5%;">
    {{#incidentes}}
        <div class="card-incidente">
            <div class="d-flex flex-row align-items-center">
                <h5 style="overflow: hidden; text-overflow:ellipsis; white-space: nowrap;">{{servicio.descripcion}}</h5>
                {{#unless estaResuelto}}
                <button type="button" style="background-color: transparent; border: none; margin-bottom: 0.3em;" data-bs-toggle="modal" data-bs-target="#confirmarCierreModal" data-incident-id="{{id}}"
                                    {{#stringIsEqual "pendientes" vista}} data-comunidad-id="{{comunidad.id}}"{{else}} data-comunidad-id="{{comunidad_id}}"{{/stringIsEqual}} {{#stringIsEqual "pendientes" vista}} data-from="pendientes"{{else}} data-from="incidentes"{{/stringIsEqual}} class="icon-button">
                                    <i class="lni lni-checkmark-circle display-icon" title="Cerrar incidente" style="color: #3bd671; margin-left: 5%;"></i>
                                    <i data-incident-id="{{id}}" {{#stringIsEqual "pendientes" vista}} data-comunidad-id="{{comunidad.id}}"{{else}} data-comunidad-id="{{comunidad_id}}"{{/stringIsEqual}}
                                        {{#stringIsEqual "pendientes" vista}} data-from="pendientes"{{else}} data-from="incidentes"{{/stringIsEqual}} class="fa-solid fa-circle-check hover-icon"
                                         style="display: none; color: #3bd671; margin-left: 5%;" title="Cerrar incidente"></i>
                                    </button>
                {{/unless}}
            </div>
            <h6 class="d-inline-block">{{establecimiento.nombre}}</h6>
            {{#stringIsEqual "pendientes" vista}}
                <h6 class="d-inline-block">{{comunidad.nombre}}</h6>
            {{/stringIsEqual}}
            <span class="mt-2 d-block">{{formatearFecha fecha}} - {{formatearUsuario reportante}}</span>
            <div class="text-area mt-1">
                {{observaciones}}
            </div>
        </div>
    {{/incidentes}}
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="confirmarCierreModal" tabindex="-1" role="dialog" aria-labelledby="confirmarCierreModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmarCierreModalLabel">Confirmar cierre de incidente</h5>
      </div>
      <form method="POST" class="m-0">
      <div class="modal-body">
        Â¿Desea cerrar el incidente?
      </div>
      <div class="modal-footer">
        <button type="button" class="grey-button" data-bs-dismiss="modal">Cancelar</button>
        <button type="submit" class="green-button">Cerrar</button>
      </div>
      </form>
    </div>
  </div>
</div>

{{/partial}}

{{> layouts/logged.html.hbs }}